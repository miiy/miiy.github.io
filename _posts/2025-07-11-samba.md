---
layout: post
title: "使用 samba "
date: 2025-07-11
tags: linux
---

## 安装

```bash
sudo apt install samba
```

开放端口

```bash
sudo ufw allow 445/tcp
```

配置文件：/etc/samba/smb.conf

查看运行状态

```bash
smbstatus
```

## 重启服务

```
sudo systemctl restart smbd
```

## 用户管理

### 添加用户

```bash
# 如果用户不存在先添加系统用户
$ sudo useradd sambauser
# 添加为 samba 用户
$ sudo smbpasswd -a sambauser
```

### 查看 samba 用户

/var/lib/samba/private/passdb.tdb 

```bash
sudo pdbedit -L
```

smbpasswd

```bash
cat /etc/samba/smbpasswd
```

## 客户端测试

```bash
sudo apt install smbclient
```

测试 guest 用户

```bash
$ smbclient //192.168.2.1/sda -U guest -N
lpcfg_do_global_parameter: WARNING: The "null passwords" option is deprecated
tree connect failed: NT_STATUS_ACCESS_DENIED
```

测试用户

```bash
$ smbclient //192.168.5.1/sda -U root
lpcfg_do_global_parameter: WARNING: The "null passwords" option is deprecated
Password for [WORKGROUP\root]:
Try "help" to get a list of possible commands.
smb: \> 
```
