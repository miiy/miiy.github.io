---
layout: post
title: "Harbor"
date: 2020-12-12
tags: harbor
---

https://goharbor.io/

## Install

安装 docker, docker-compose

```bash
cd /usr/local/src
wget harbor-online-installer-v2.2.0.tgz
tar -zxvf harbor-online-installer-v2.2.0.tgz
mv harbor harbor-v2.2.0
mv harbor-v2.2.0 ../
cd ../
ln -s harbor-v2.2.0 harbor
```

生成证书

https://goharbor.io/docs/2.2.0/install-config/configure-https/

```bash

mkdir -p /data/harbor/certs
cd /data/harbor/harbor

openssl genrsa -out harbor.k8s.local.key 4096

openssl req -sha512 -new \
    -subj "/C=CN/ST=Beijing/L=Beijing/O=exampleOrg/CN=harbor.k8s.local" \
    -key harbor.k8s.local.key \
    -out harbor.k8s.local.csr

openssl x509 -req  -days 3650 \
    -in harbor.k8s.local.csr \
    -signkey harbor.k8s.local.key \
    -out harbor.k8s.local.crt
```

修改配置文件

```bash
cd /usr/local/harbor
cp harbor.yaml.tmpl harbor.yaml
vi harbor.yaml
```

```text
hostname: harbor.k8s.local

certificate: /data/harbor/certs/harbor.k8s.local.crt
private_key: /data/harbor/certs/harbor.k8s.local.key

data_volume: /data/harbor/data
```

安装

```bash
./install.sh
```
